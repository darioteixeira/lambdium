Array.prototype.min=function(){return Math.min.apply(null,this)};Array.prototype.max=function(){return Math.max.apply(null,this)};Array.toArray=function(c){if(!c){return[]}else{var a=[];for(var b=0;b<c.length;b++){a.push(c[b])}return a}};Function.prototype.bind=function(a){var c=this;var b=Array.toArray(arguments);a=b.shift();return function(){var d=Array.toArray(b);return c.apply(a,b.concat(d))}};Function.prototype.bindAsEventListener=function(a){var c=this;var b=Array.toArray(arguments);a=b.shift();return function(e){var d=Array.toArray(arguments);return c.apply(a,[(e||window.event)].concat(b).concat(d))}};var Evt={};Evt.register=function(c,b,a){var d="on"+a;if(c.addEventListener){c.addEventListener(a,b,false)}else{if(c.attachEvent){c.attachEvent(d,b)}else{if(d in c){c[d]=b}}}};Evt.unregister=function(c,b,a){var d="on"+a;if(c.removeEventListener){c.removeEventListener(a,b,false)}else{if(c.dettachEvent){c.dettachEvent(d,b)}else{if(d in c){c[d]=null}}}};Evt.getProper=function(a){return a||window.event};Evt.getCurrentTarget=function(a){return a.currentTarget||a.srcElement};Evt.getOriginalTarget=function(a){return a.target||a.srcElement};Evt.getExplicitTarget=function(a){return a.explicitOriginalTarget};Evt.cancelDefault=function(a){if(a.preventDefault){a.preventDefault()}else{if(a.returnValue){a.returnValue=false}}};Evt.getAbsoluteX=function(a){return a.pageX||(a.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft))};Evt.getAbsoluteY=function(a){return a.pageY||(a.clientY+(document.documentElement.scrollTop||document.body.scrollTop))};Evt.getViewportX=function(a){return a.clientX};Evt.getViewportY=function(a){return a.clientY};var Dom={};Dom.getElementsByAttr=function(d,a,f,h){var b=d.getElementsByTagName(a);var g=[];var e=new RegExp("\\b"+h+"\\b");for(var c=0;c<b.length;c++){var j=b[c];if(e.test(j[f])){g.push(j)}}return g};Dom.getElementsByClassName=function(a,b,c){return Dom.getElementsByAttr(a,b,"className",c)};Dom.getAncestor=function(b,a,c){while((b!==a)&&!c(b)){b=b.parentNode}return b};Dom.getAncestorByTagName=function(c,a,b){var d=function(e){return e.nodeName===b};return Dom.getAncestor(c,a,d)};Dom.getAncestorByClassName=function(c,a,b){var d=function(e){return b.isMatch(e,b)};return Dom.getAncestor(c,a,d)};var Obj={};Obj.setup=function(){Obj.objects=[]};Obj.finalise=function(){while(Obj.objects.length>0){var a=Obj.objects.pop();a.finalise()}};Obj.add=function(a){Obj.objects.push(a)};Node.prototype.getNextSibling=function(){var a=this.nextSibling;while(a&&(a.nodeType!==Node.ELEMENT_NODE)){a=a.nextSibling}return a};Node.prototype.getFirstChild=function(){var a=this.firstChild;while(a&&(a.nodeType!==Node.ELEMENT_NODE)){a=a.nextSibling}return a};Node.prototype.getLastChild=function(){var a=this.lastChild;while(a&&(a.nodeType!==Node.ELEMENT_NODE)){a=a.previousSibling}return a};Node.prototype.prependChild=function(a){this.insertBefore(a,this.firstChild)};var Ajaxer={};Ajaxer.PROTOCOL_GET="GET";Ajaxer.PROTOCOL_POST="POST";Ajaxer.encodeData=function(e){var d=[];var c=/%20/g;for(var a in e){var b=e[a].toString();var f=encodeURIComponent(a).replace(c,"+")+"="+encodeURIComponent(b).replace(c,"+");d.push(f)}return d.join("&")};Ajaxer.factories=[function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];Ajaxer.factory=null;Ajaxer.newRequest=function(){if(Ajaxer.factory!==null){return Ajaxer.factory()}for(var b=0;b<Ajaxer.factories.length;b++){try{var a=Ajaxer.factories[b];var c=a();if(c!==null){Ajaxer.factory=a;return c}}catch(d){continue}}Ajaxer.factory=function(){throw new Error("XmlHttpRequest is not supported")};Ajaxer.factory()};Ajaxer.executeRequest=function(i,c,f,h,g,j){var e=Ajaxer.newRequest();var d;if(!j){j={}}if(j.timeout){var b=function(){e.onreadystatechange=function(){};e.abort();if(j.timeoutHandler){j.timeoutHandler()}};d=setTimeout(b,j.timeout)}e.onreadystatechange=function(){if(e.readyState===4){if(d){clearTimeout(d)}var k=g;try{if(e.status===200){k=h}}catch(l){}k(e)}};e.open(i,c,true);e.setRequestHeader("User-Agent","XMLHTTP");if(j.requestHeaders){for(var a in j.requestHeaders){e.setRequestHeader(a,j.requestHeaders[a])}}e.send(f)};Ajaxer.get=function(e,b,d,a,c){if(b){var f=Ajaxer.encodeData(b);e=e+"?"+f}Ajaxer.executeRequest(Ajaxer.PROTOCOL_GET,e,null,d,a,c)};Ajaxer.post=function(e,b,d,a,c){var f=Ajaxer.encodeData(b);if(!c){c={}}if(!c.requestHeaders){c.requestHeaders={}}c.requestHeaders["Content-Type"]="application/x-www-form-urlencoded";Ajaxer.executeRequest(Ajaxer.PROTOCOL_POST,e,f,d,a,c)};function Previewer(a){this.form=a;this.submitBinding=this.submitHandler.bindAsEventListener(this);Evt.register(this.form,this.submitBinding,"submit")}Previewer.prototype.finalise=function(){};Previewer.prototype.submitHandler=function(a){var g=Evt.getExplicitTarget(a);if(g.value==="Preview"){Evt.cancelDefault(a);var e=this.form.action.replace(/add_comment/,"preview_comment");var c={};c.sid=this.form.sid.value;c.title=this.form.title.value;c.body=this.form.body.value;var f=this;var d=function(h){f.successHandler(h)};var b=function(h){f.errorHandler(h)};Ajaxer.post(e,c,d,b)}};Previewer.prototype.successHandler=function(request){var response=eval("("+request.responseText+")");var container=this.getContainer();container.innerHTML=response.content};Previewer.prototype.errorHandler=function(b){var a=this.getContainer();a.innerHTML='<h1 class="error_msg">Could not get preview!</h1>'};Previewer.prototype.getContainer=function(){var a=this.form.parentNode;var b=a.getLastChild();if(b.className!=="comment_preview_wrapper"){b=document.createElement("div");b.className="comment_preview_wrapper";a.appendChild(b)}else{while(b.childNodes.length>0){b.removeChild(b.childNodes[0])}}return b};Previewer.setup=function(){var b=Dom.getElementsByClassName(document,"FORM","previewable");for(var a=0;a<b.length;a++){Obj.add(new Previewer(b[a]))}};Previewer.finalise=function(){};var Main={};Main.setup=function(){Obj.setup();Previewer.setup()};Main.finalise=function(){Previewer.finalise();Obj.finalise()};Evt.register(window,Main.setup,"load");Evt.register(window,Main.finalise,"unload");